// STL includes
#include <vector>
#include <string>

// C includes

// Library includes
#include <cxxtest/TestSuite.h>

// Project includes
#include <Connector.h>

using namespace std;

class ConnectorTestSuite: public CxxTest::TestSuite
{
  struct Sender: public Connectable
  {
    void sendTest(void)
    {
      emit("test");
    }
    void sendFive(void)
    {
      emit("five");
    }
    Sender(Connector& _conn): Connectable(_conn) {}
  };
  struct Receiver: public Connectable
  {
    int num_received;
    Receiver(Connector& _conn): Connectable(_conn), num_received(0) {}
    virtual void onNotify(const Connectable* ,const char* signal)
    {
      if ( !strcmp(signal,"test") )
	++ num_received;
      else if ( !strcmp(signal,"five") )
	num_received += 5;
    }
  };
  Connector* pconn;
  Sender *psend;
  Receiver *precv;
public:
  void setUp()
  {
    pconn = new Connector;
    psend = new Sender(*pconn);
    precv = new Receiver(*pconn);
  }
  void tearDown()
  {
    delete precv;
    delete psend;
    delete pconn;
  }

  void testEmpty( void )
  {
    TS_ASSERT_EQUALS( pconn->size(), 0 );
  }
  void testAdd( void )
  {
    precv->listen(/*from*/psend,/*signal*/"test");
    TS_ASSERT_EQUALS( pconn->size(), 1 );
  }
  void testSend( void )
  {
    precv->listen(/*from*/psend,/*signal*/"test");
    psend->sendTest();

    TS_ASSERT_EQUALS( precv->num_received, 1 );
  }
  void testSendTwo( void )
  {
    precv->listen(/*from*/psend,/*signal*/"test");
    precv->listen(/*from*/psend,/*signal*/"five");
    psend->sendTest();
    psend->sendFive();

    TS_ASSERT_EQUALS( precv->num_received, 6 );
  }
  void testSendTwoSame( void )
  {
    precv->listen(/*from*/psend,/*signal*/"test");
    precv->listen(/*from*/psend,/*signal*/"five");
    psend->sendTest();
    psend->sendTest();

    TS_ASSERT_EQUALS( precv->num_received, 2 );
  }
  void testSendMissing( void )
  {
    precv->listen(/*from*/psend,/*signal*/"test");
    precv->listen(/*from*/psend,/*signal*/"something");
    psend->sendTest();

    TS_ASSERT_EQUALS( precv->num_received, 1 );
  }
};
// vim:cin:ai:sts=2 sw=2 ft=cpp
